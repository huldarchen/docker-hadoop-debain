version: '3'

services:
  # namenode节点
  namenode:
    build: .
    image: huldarchen/hadoop-namenode:debian_x64
    hostname: namenode
    ports:
      - 9870:9870
      - 8088:8088
      - 8983:8983
    networks:
      - hadoop-network
    volumes:
      - hadoop:/data/hadoop
    environment:
      HADOOP_MODE: namenode
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:9870']
      interval: 15s
      timeout: 5s
      retries: 5

  datanode:
    build: .
    image: huldarchen/hadoop-datanode:debian_x64
    networks:
      - hadoop-network
    volumes:
      - hadoop:/data/hadoop
    depends_on:
      namenode:
        condition: service_healthy
    environment:
      HADOOP_MODE: datanode
  
  mysql8:
    build: ./mysql
    image: mysql:8.0.33-debian
    container_name: mysql8-hive
    networks:
      -hadoop-network
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: Pwd@root830
      
    command: 
      - default-authentication-plugin=mysql_native_password
      - character-set-server=utf8mb4
      - collation-server=utf8mb4_general_ci
      - explicit_defaults_for_timestamp=true
      - lower_case_table_names=1
    ports:
      - 3310:3306
    volumes:
      - mysql8_data:/var/lib/mysql
    
  hive:
    build: .
    image: huldarchen/hadoop-hive:debian_x64
    networks:
      - hadoop-network
    depends_on:
      - mysql8
    environment:
      - HADOOP_MODE=hive

networks:
  hadoop:


volumes:
  solr:
  hadoop: